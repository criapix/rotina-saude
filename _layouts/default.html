<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>{{ page.title }} — {{ site.title }}</title>
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="{{ '/manifest.json' | relative_url }}">
  <link rel="icon" href="{{ '/icon.svg' | relative_url }}" type="image/svg+xml">
  <link rel="apple-touch-icon" href="{{ '/icon.svg' | relative_url }}">
  <style>
    :root {
      --sidebar-w: 260px;
      --header-h: 48px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --bg: #f8fafc;
      --bg-sidebar: #1e293b;
      --bg-header: #0f172a;
      --text: #1e293b;
      --text-light: #94a3b8;
      --text-sidebar: #cbd5e1;
      --accent: #3b82f6;
      --border: #e2e8f0;
      --color-gym: #3b82f6;
      --color-nutrition: #10b981;
      --color-cycling: #f59e0b;
      --color-health: #8b5cf6;
      --color-home: #64748b;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 16px; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
      overscroll-behavior-y: contain;
    }

    /* Header */
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      height: calc(var(--header-h) + var(--safe-top));
      padding-top: var(--safe-top);
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      display: flex; align-items: center;
      padding-left: 16px; padding-right: 16px;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .header-title {
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      margin-left: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .header-icon {
      width: 20px; height: 20px;
      margin-left: 12px;
      flex-shrink: 0;
    }
    .menu-btn {
      background: none; border: none;
      color: #fff; cursor: pointer;
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 6px;
      flex-shrink: 0;
      -webkit-tap-highlight-color: transparent;
    }
    .menu-btn:hover { background: rgba(255,255,255,0.1); }
    .menu-btn svg { width: 22px; height: 22px; }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: calc(var(--header-h) + var(--safe-top));
      left: 0; bottom: 0;
      width: var(--sidebar-w);
      background: var(--bg-sidebar);
      transform: translateX(-100%);
      transition: transform 0.25s ease;
      z-index: 90;
      overflow-y: auto;
      padding: 20px 0;
      padding-bottom: calc(20px + var(--safe-bottom));
      -webkit-overflow-scrolling: touch;
    }
    .sidebar.open { transform: translateX(0); }
    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      color: var(--text-sidebar);
      text-decoration: none;
      font-size: 0.88rem;
      border-left: 3px solid transparent;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .sidebar-nav a:hover {
      background: rgba(255,255,255,0.05);
      color: #fff;
    }
    .sidebar-nav a.active {
      color: #fff;
      background: rgba(255,255,255,0.08);
      font-weight: 600;
    }
    .sidebar-nav a.active.nav-home { border-left-color: var(--color-home); }
    .sidebar-nav a.active.nav-gym { border-left-color: var(--color-gym); }
    .sidebar-nav a.active.nav-nutrition { border-left-color: var(--color-nutrition); }
    .sidebar-nav a.active.nav-cycling { border-left-color: var(--color-cycling); }
    .sidebar-nav a.active.nav-health { border-left-color: var(--color-health); }
    .sidebar-nav .nav-icon {
      width: 18px; height: 18px;
      flex-shrink: 0;
      opacity: 0.7;
    }
    .sidebar-nav a:hover .nav-icon,
    .sidebar-nav a.active .nav-icon { opacity: 1; }
    .sidebar-label {
      padding: 8px 20px 6px;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-light);
    }

    /* Overlay */
    .overlay {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 80;
    }
    .overlay.show { display: block; }

    /* Main */
    .main {
      margin-top: calc(var(--header-h) + var(--safe-top));
      padding: 32px 24px;
      padding-bottom: calc(64px + var(--safe-bottom));
      max-width: 860px;
      margin-left: auto;
      margin-right: auto;
      transition: opacity 0.2s ease, transform 0.2s ease, margin-left 0.25s ease;
    }
    .main.fading { opacity: 0; transform: translateY(8px); }

    /* Desktop */
    @media (min-width: 769px) {
      .sidebar { transform: translateX(0); }
      .sidebar.closed { transform: translateX(-100%); }
      .main { margin-left: var(--sidebar-w); max-width: calc(860px + var(--sidebar-w)); }
      .main.full { margin-left: auto; }
      .overlay { display: none !important; }
    }

    /* Content styles */
    .main h1 { font-size: 1.6rem; margin: 0 0 16px; padding-bottom: 8px; border-bottom: 2px solid var(--border); }
    .main h2 { font-size: 1.25rem; margin: 28px 0 12px; color: #334155; }
    .main h3 { font-size: 1.05rem; margin: 20px 0 8px; color: #475569; }
    .main p { margin: 8px 0; }
    .main ul, .main ol { margin: 8px 0; padding-left: 24px; }
    .main li { margin: 4px 0; }
    .main table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 0.88rem;
      overflow-x: auto;
      display: block;
    }
    .main th, .main td {
      padding: 8px 12px;
      border: 1px solid var(--border);
      text-align: left;
    }
    .main th { background: #f1f5f9; font-weight: 600; white-space: nowrap; }
    .main tr:hover td { background: #f8fafc; }
    .main blockquote {
      margin: 12px 0;
      padding: 12px 16px;
      border-left: 4px solid var(--accent);
      background: #eff6ff;
      border-radius: 0 6px 6px 0;
      font-size: 0.92rem;
    }
    .main code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.88em;
    }
    .main strong { color: #0f172a; }
    .main hr { border: none; border-top: 1px solid var(--border); margin: 24px 0; }
    .main a { color: var(--accent); text-decoration: none; }
    .main a:hover { text-decoration: underline; }

    /* Index page — doc-links cards */
    .main .doc-links { list-style: none; padding: 0; }
    .main .doc-links li { margin: 0; }
    .main .doc-links a {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 18px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin: 10px 0;
      transition: all 0.2s;
      font-weight: 500;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .main .doc-links a:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-decoration: none;
    }
    .main .doc-links .card-icon {
      width: 40px; height: 40px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .main .doc-links .card-icon svg { width: 22px; height: 22px; }
    .main .doc-links .card-icon.gym { background: #dbeafe; color: var(--color-gym); }
    .main .doc-links .card-icon.nutrition { background: #d1fae5; color: var(--color-nutrition); }
    .main .doc-links .card-icon.cycling { background: #fef3c7; color: var(--color-cycling); }
    .main .doc-links .card-icon.health { background: #ede9fe; color: var(--color-health); }
    .main .doc-links a:hover .card-icon.gym { background: var(--color-gym); color: #fff; }
    .main .doc-links a:hover .card-icon.nutrition { background: var(--color-nutrition); color: #fff; }
    .main .doc-links a:hover .card-icon.cycling { background: var(--color-cycling); color: #fff; }
    .main .doc-links a:hover .card-icon.health { background: var(--color-health); color: #fff; }
    .main .doc-links .card-text { display: flex; flex-direction: column; }
    .main .doc-links .card-title { font-size: 0.95rem; color: var(--text); }
    .main .doc-links .card-desc { font-size: 0.78rem; color: var(--text-light); font-weight: 400; margin-top: 2px; }
    .main .doc-links a:hover .card-title { color: var(--accent); }
  </style>
</head>
<body>
  <header class="header">
    <button class="menu-btn" onclick="toggleSidebar()" aria-label="Menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/>
    </svg>
    <span class="header-title">{{ site.title }}</span>
  </header>

  <nav class="sidebar" id="sidebar">
    <div class="sidebar-label">Documentos</div>
    <div class="sidebar-nav">
      <a href="{{ '/' | relative_url }}" class="nav-home {% if page.url == '/' %}active{% endif %}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        Inicio
      </a>
      <a href="{{ '/serie-academia' | relative_url }}" class="nav-gym {% if page.title == 'Série de Musculação' %}active{% endif %}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6.5 6.5h-2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h2"/><path d="M17.5 6.5h2a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1h-2"/><rect x="6.5" y="4" width="2" height="16" rx="1"/><rect x="15.5" y="4" width="2" height="16" rx="1"/><line x1="8.5" y1="12" x2="15.5" y2="12"/>
        </svg>
        Musculacao
      </a>
      <a href="{{ '/Recomendação nutricional/Plano nutricional' | relative_url }}" class="nav-nutrition {% if page.title == 'Plano Nutricional' %}active{% endif %}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/>
        </svg>
        Nutricao
      </a>
      <a href="{{ '/Pedal/Rotina de pedaladas' | relative_url }}" class="nav-cycling {% if page.title == 'Rotina de Pedaladas' %}active{% endif %}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill="currentColor"/><path d="M12 17.5V14l-3-3 4-3 2 3h3"/>
        </svg>
        Pedaladas
      </a>
      <a href="{{ '/dados-saude' | relative_url }}" class="nav-health {% if page.title == 'Consolidação Clínica' %}active{% endif %}">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
        Saude
      </a>
    </div>
  </nav>

  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <main class="main" id="main">
    {{ content }}
  </main>

  <script>
    var sidebar = document.getElementById('sidebar');
    var overlay = document.getElementById('overlay');
    var main = document.getElementById('main');
    var isDesktop = window.innerWidth >= 769;

    if (isDesktop) sidebar.classList.add('open');

    function toggleSidebar() {
      if (isDesktop) {
        sidebar.classList.toggle('closed');
        main.classList.toggle('full');
      } else {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('show');
      }
    }

    window.addEventListener('resize', function() {
      var wasDesktop = isDesktop;
      isDesktop = window.innerWidth >= 769;
      if (wasDesktop !== isDesktop) {
        sidebar.className = 'sidebar';
        overlay.className = 'overlay';
        main.className = 'main';
        if (isDesktop) sidebar.classList.add('open');
      }
    });

    /* ── SPA Navigation ── */
    var pageCache = {};
    var navigating = false;

    function normPath(url) {
      return decodeURIComponent(new URL(url, location.href).pathname).replace(/\/+$/, '') || '/';
    }

    pageCache[normPath(location.href)] = { html: main.innerHTML, title: document.title };

    function updateActive(url) {
      var path = normPath(url);
      document.querySelectorAll('.sidebar-nav a').forEach(function(a) {
        if (normPath(a.href) === path) {
          a.classList.add('active');
        } else {
          a.classList.remove('active');
        }
      });
    }

    function navigateTo(url, push) {
      if (navigating) return;
      var key = normPath(url);
      if (key === normPath(location.href) && push !== false) return;

      navigating = true;
      main.classList.add('fading');

      function render(data) {
        setTimeout(function() {
          main.innerHTML = data.html;
          document.title = data.title;
          window.scrollTo(0, 0);
          if (push !== false) history.pushState(null, '', url);
          updateActive(url);
          if (!isDesktop && sidebar.classList.contains('open')) toggleSidebar();
          main.classList.remove('fading');
          navigating = false;
        }, 200);
      }

      if (pageCache[key]) {
        render(pageCache[key]);
      } else {
        fetch(url).then(function(r) { return r.text(); }).then(function(html) {
          var doc = new DOMParser().parseFromString(html, 'text/html');
          var m = doc.getElementById('main');
          var t = doc.querySelector('title');
          if (m) {
            var data = { html: m.innerHTML, title: t ? t.textContent : document.title };
            pageCache[key] = data;
            render(data);
          } else {
            location.href = url;
          }
        }).catch(function() { location.href = url; });
      }
    }

    document.addEventListener('click', function(e) {
      var link = e.target.closest('a');
      if (!link) return;
      var href = link.getAttribute('href');
      if (!href || href.charAt(0) === '#') return;
      try {
        var dest = new URL(href, location.href);
        if (dest.origin !== location.origin) return;
        e.preventDefault();
        navigateTo(dest.href);
      } catch(ex) {}
    });

    window.addEventListener('popstate', function() {
      navigateTo(location.href, false);
    });

    /* ── Service Worker ── */
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ "/sw.js" | relative_url }}');
    }
  </script>
</body>
</html>
